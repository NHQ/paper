<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>HSLColor</title>
	<link rel="stylesheet" href="../css/style.css">
	<script type="text/javascript" src="../javascripts/paper.js"></script>
	<script type="text/javascript" src="../javascripts/underscore-min.js"></script>
	<script type="text/paperscript" canvas="canvas">

	var point = view.center;
	//pal = new HSBColor(110, 1, 1);
 	mouse = [];
	line = new Path();
	line.add(100,100);
		line.add(200,100);
	
	colorPicker = {
		init: function(){
			this.Selector();
		},
		Selector : function(){
		  this.group = new Group();
			this.pal =  new HSBColor(110, 1, 1);
			this.bg = [];
			for (i=35;i>0;--i){
				this.bg[i] = new Path([3,(i*10)],[358,0+(i*10)]);
				this.bg[i].strokeWidth = 5;
				this.bg[i].strokeColor = "#c1c2c3";
				this.group.addChild(this.bg[i])
			}
			this.sb = new Path.Circle(180, 180, 180);
			this.sb.fillColor = this.pal;
			//this.sb.strokeColor = "#fff"; 
			//this.sb.strokeWidth = 3; 
			this.circ = new Path.Circle(this.sb.position.x,this.sb.position.y,6);
			this.circ.strokeColor = "black";
			this.circ.strokeWidth = 3;
			
			var colors = [];
			var cycles = 4;
			for (var i = 0, l = 360; i < l; i++) {
				var brightness = 1;
				var hue = i;
				var color = new HSBColor(hue, 1, brightness);
				colors.push(color);
			}
		
			this.hueSelect = new Path.Rectangle(0,375,360,30);
			var gradient = new Gradient(colors);
			var gradientColor = new GradientColor(gradient, this.hueSelect.bounds.bottomLeft,this.hueSelect.bounds.bottomRight);
			this.hueSelect.fillColor = gradientColor;
			
			this.tiny = new Path.Circle([110, 390],3);
			this.tiny.fillColor= "white";
			this.tiny.strokeColor = "#000";
			
			this.as = new Path.Rectangle(375,0,30,360);
			this.palAlpha1 = this.pal.clone();
			this.palAlphaZero = this.pal.clone();
			this.palAlphaZero.alpha = 0;
			var gradient = new Gradient([[this.palAlphaZero],[this.palAlpha1,.67]]);
			var gradientColor = new GradientColor(gradient, this.as.bounds.topLeft,this.as.bounds.bottomLeft);
			this.as.fillColor = gradientColor;
			//layer.remove();
			this.group.addChildren([this.as, this.sb, this.hueSelect, this.tiny, this.circ]);
			this.group.selected = false;
			this.group.position = [view.bounds.right - 225,view.bounds.bottom - 225];
			//alert(layer.bounds)
			//this.picker = new Group([this.pal, this.sb, this.circ, this.hueSelect, this.as, this.palAlphaZero, this.palAlpha1]);
			
		},
		mouseMove: {
			hues : function (event){
				if (this.hueSelect.hitTest(event.point, {fill:true})){
					console.log(this);
					//this.sb = new Path.Rectangle(0, 0, 360, 360);
					this.sb.fillColor = pal.clone();
					this.pal.hue = (event.point.x - this.hueSelect.bounds.left);
					this.sb.fillColor.hue = (event.point.x - this.hueSelect.bounds.left);
					this.tiny.position.x = event.point.x
					this.sb.fillColor.alpha = 1;
				}},
			sb: function (event){
				if (this.sb.hitTest(event.point, {fill:true})){
					//this.circ.position = event.point;
					this.sb.fillColor.saturation = event.point.y / 360 ;
					this.sb.fillColor.brightness = event.point.x / 360;
				}
				if (!this.sb.hitTest(event.point, {fill:true})){
					//this.circ.position = event.point;
				//	this.sb.fillColor.saturation = pal.saturation;
					//this.sb.fillColor.brightness = pal.brightnes;
				}
			}},
		mouseDown: function (event){

			/* If we produced a line before, deselect it:
			if (line) {
				line.selected = false;
			}
				// Create a new line and set its stroke color to black:
			line = new Path();
			line.add(event.point);
			line.strokeColor = pal.clone();
			line.strokeWidth = 7;
			*/
			if (this.sb.hitTest(event.point, {fill:true})){
				this.circ.position = event.point;
				var bright = (360 - Math.abs((event.point.x - this.sb.position.x)*2))/360;
				var sat = (360 - Math.abs((event.point.y - this.sb.position.y)*2))/360;;
				this.sb.fillColor.saturation = sat;
				this.sb.fillColor.brightness =  bright;
				this.pal.brightness = bright;
				this.pal.saturation = sat;
				this.palAlphaZero.saturation = sat;
				this.palAlphaZero.brightness = bright;
				this.palAlpha1.saturation = sat;
				this.palAlpha1.brightness = bright;
			}
			if (this.hueSelect.hitTest(event.point, {fill:true})){
				console.log(this);
				//this.sb = new Path.Rectangle(0, 0, 360, 360);
				this.sb.fillColor = this.pal.clone();
				this.pal.hue = (event.point.x - this.hueSelect.bounds.left);
				this.sb.fillColor.hue = (event.point.x - this.hueSelect.bounds.left);
				this.tiny.position.x = event.point.x
				//this.sb.fillColor.alpha = 1;
				this.palAlphaZero.hue = (event.point.x - this.hueSelect.bounds.left);
				this.palAlpha1.hue = (event.point.x - this.hueSelect.bounds.left);
			}
			if (this.as.hitTest(event.point, {fill:true})){
				this.pal.alpha = event.point.y / 360;
				this.sb.alpha = event.point.y / 360;
			//	this.this.palAlphaZero = 
				//this.palAlpha1
			}
			
		},

		mouseDrag : function (event) {
			//line.add(event.point);
			
			// S/B
			if (this.hueSelect.hitTest(event.point, {fill:true})){
				console.log(this);
				//this.sb = new Path.Rectangle(0, 0, 360, 360);
				this.sb.fillColor = this.pal.clone();
				this.pal.hue = (event.point.x - this.hueSelect.bounds.left);
				this.sb.fillColor.hue = (event.point.x - this.hueSelect.bounds.left);
				this.tiny.position.x = event.point.x
				//this.sb.fillColor.alpha = 1;
				this.palAlphaZero.hue = (event.point.x - this.hueSelect.bounds.left);
				this.palAlpha1.hue = (event.point.x - this.hueSelect.bounds.left);
			}
			if (this.as.hitTest(event.point, {fill:true})){
				this.pal.alpha = (event.point.y - this.as.bounds.top) / 340;
				this.sb.alpha = (event.point.y - this.sb.bounds.top) / 360;
			//	this.this.palAlphaZero = 
				//this.palAlpha1
			}
			if (this.sb.hitTest(event.point, {fill:true})){
				this.circ.position = event.point;
				var bright = (360 - Math.abs((event.point.x - this.sb.position.x)*2))/360;
				var sat = (360 - Math.abs((event.point.y - this.sb.position.y)*2))/360;;
				this.sb.fillColor.saturation = sat;
				this.sb.fillColor.brightness =  bright;
				this.pal.brightness = bright;
				this.pal.saturation = sat;
				this.palAlphaZero.saturation = sat;
				this.palAlphaZero.brightness = bright;
				this.palAlpha1.saturation = sat;
				this.palAlpha1.brightness = bright;
			}
			
			
		},

		mouseUp: function (event) {
			/*
			var segmentCount = line.segments.length;

			// When the mouse is released, simplify it:
			line.simplify(0);
			//line.smooth();

			// Select the line, so we can see its segments:
			line.fullySelected = false;

			var newSegmentCount = line.segments.length;
			var difference = segmentCount - newSegmentCount;
			var percentage = 100 - Math.round(newSegmentCount / segmentCount * 100);
			//textItem.content = difference + ' of the ' + segmentCount + ' segments were removed. Saving ' + percentage + '%\n meanwhile, here is your line data: '+line.segments;
			*/
		}
	};
_.bindAll(colorPicker);
colorPicker.mouseMove.hues = _.bind(colorPicker.mouseMove.hues, colorPicker)
colorPicker.mouseMove.sb = _.bind(colorPicker.mouseMove.sb, colorPicker)

colorPicker.init();
console.log(colorPicker.sb)
/*
function onMouseMove(event){
	colorPicker.mouseMove.hues(event)
	colorPicker.mouseMove.sb(event)
}
*/
function onMouseDrag(event){
	colorPicker.mouseDrag(event)
}
function onMouseDown(event){
	colorPicker.mouseDown(event)
}
function onMouseUp(event){
	colorPicker.mouseUp(event)
}
function onResize(event) {

}
	</script>
</head>
<body>
	<canvas id="canvas" resize style="background:black"></canvas>
</body>
</html>