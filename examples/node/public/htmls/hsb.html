<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>HSLColor</title>
	<script type="text/javascript" src="../javascripts/paper.js"></script>
	<script type="text/javascript" src="../javascripts/underscore-min.js"></script>
	
	<script type="text/javascript">
paper.install(window);
window.onload = function(){
  function hex2a(hex) {
      var str = '';
      for (var i = 0; i < hex.length; i += 2)
          str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
      return str;
  }

sinceLast = new Date().getTime();  
  
  paper.setup('canvas');
	var lino = new Path([515,0],[515,500]);
	lino.strokeWidth = 7;
  lino.strokeColor = "#c1c2c3";
	var point = view.center;
	//pal = new HSBColor(110, 1, 1);
 	mouse = [];
	line = new Path();
	line.add(100,100);
		line.add(200,100);
	
	colorPicker = {
		init: function(){
			this.Selector();
			_.bindAll(colorPicker);
			this.tool = new Tool();
			this.tool.onMouseDrag = this.mouseDrag;
			this.tool.onMouseUp = this.mouseUp;
			this.tool.activate();
		},
		pallette : {
		  set: function(color){
		    if (color){
		      this.get.unshift(color)
		      this.set();
		      return		      		        
		      }
		    this.swathii.remove();
		    this.swathii = new Group();
		    this.swath = [];
		    for (var x in this.get){
		      this.swath[x] = new Path.Circle(515,(x*53)+26,25);
		      //this.swath[x].strokeColor = "#333";
		      this.swath[x].fillColor = this.get[x];
		      this.swathii.addChild(this.swath[x])
		    }  
		    //this.swathii.position = [550,0]
		    },
		  get: [],
		  swathii: new Group(),
		  swath:[]
		},
		Selector : function(){
		  this.group = new Group();
			this.pal =  new HSBColor(210, 1, 1);
			this.bg = [];
			for (i=35;i>0;--i){
				this.bg[i] = new Path([3,(i*10)],[358,0+(i*10)]);
				this.bg[i].strokeWidth = 5;
				this.bg[i].strokeColor = "#c1c2c3";
				this.group.addChild(this.bg[i])
			}
			this.sb = new Path.Circle(180, 180, 180);
			this.sb.fillColor = this.pal;
			this.circ = new Path.Circle(this.sb.position.x,this.sb.position.y,6);
			this.circ.strokeColor = "black";
			this.circ.strokeWidth = 3;
			var colors = [];
			var cycles = 4;
			for (var i = 0, l = 360; i < l; i++) {
				var brightness = 1;
				var hue = i;
				var color = new HSBColor(hue, 1, brightness);
				colors.push(color);
			}
		
			this.hueSelect = new Path.Rectangle(0,375,360,30);
			var gradient = new Gradient(colors);
			var gradientColor = new GradientColor(gradient, this.hueSelect.bounds.bottomLeft,this.hueSelect.bounds.bottomRight);
			this.hueSelect.fillColor = gradientColor;
			
			this.tiny = new Path.Circle([210, 390],3);
			this.tiny.fillColor= "white";
			this.tiny.strokeColor = "#000";
			
			this.as = new Path.Rectangle(375,-10,30,360);
			this.palAlpha1 = this.pal.clone();
			this.palAlphaZero = this.pal.clone();
			this.palAlphaZero.alpha = 0;
			var gradient = new Gradient([[this.palAlphaZero],[this.palAlpha1]]);
			var gradientColor = new GradientColor(gradient, this.as.bounds.topLeft,this.as.bounds.bottomLeft);
			this.as.fillColor = gradientColor;
			this.add = new PointText([367,410]);
			this.add.content= "+";
			this.add.characterStyle = {
          fontSize: 60,
      }
      this.add.strokeJoin = 'round';
			this.add.fillColor = "#000";
			this.add.strokeColor = "#fff"
			
			this.addRect = new Path.Rectangle(new Point(367,365), new Size(48,48));
			//var cornerSize = new Size(20, 20);
			//this.addRect = new Path.RoundRectangle(aRex, cornerSize);
			
			this.addRect.strokeColor = "#fff";
			this.addRect.fillColor = "#fff";
			this.addRect.fillColor.alpha = 0;
			
			this.group.addChildren([this.as, this.sb, this.hueSelect, this.tiny, this.circ, this.add, this.addRect]);
			this.group.selected = false;
			this.group.position = [view.bounds.left + 225,view.bounds.bottom - 225];
			
			
			
//			this.add = new Path([[25,25],[25,10],[35,10],[25,35]]);
		},
		mouseUp: function (event){
		  if( (new Date().getTime() - sinceLast) < 1000){
		    return
		  }
		  sinceLast = new Date().getTime();

			/* If we produced a line before, deselect it:
			if (line) {
				line.selected = false;
			}
				// Create a new line and set its stroke color to black:
			line = new Path();
			line.add(event.point);
			line.strokeColor = pal.clone();
			line.strokeWidth = 7;
			*/
			if (this.sb.hitTest(event.point, {fill:true})){
				this.circ.position = event.point;
				var bright = (360 - Math.abs((event.point.x - this.sb.position.x)*2))/360;
				var sat = (360 - Math.abs((event.point.y - this.sb.position.y)*2))/360;;
				this.sb.fillColor.saturation = sat;
				this.sb.fillColor.brightness =  bright;
				this.pal.brightness = bright;
				this.pal.saturation = sat;
				this.palAlphaZero.saturation = sat;
				this.palAlphaZero.brightness = bright;
				this.palAlpha1.saturation = sat;
				this.palAlpha1.brightness = bright;
			}
			if (this.hueSelect.hitTest(event.point, {fill:true})){
				this.sb.fillColor = this.pal.clone();
				this.pal.hue = (event.point.x - this.hueSelect.bounds.left);
				this.sb.fillColor.hue = (event.point.x - this.hueSelect.bounds.left);
				this.tiny.position.x = event.point.x
				this.palAlphaZero.hue = (event.point.x - this.hueSelect.bounds.left);
				this.palAlpha1.hue = (event.point.x - this.hueSelect.bounds.left);
			}
			if (this.as.hitTest(event.point, {fill:true})){
				this.pal.alpha = (event.point.y - this.as.bounds.top) / 340;
				this.sb.alpha = (event.point.y - this.sb.bounds.top) / 360;
			}
			if(this.addRect.hitTest(event.point, {fill:true})){
			  this.pallette.set(this.pal.clone());
			  console.log(this.pallette)
			}
			if(this.pallette.swathii.hitTest(event.point, {fill:true})){
			  console.log(this.pallette.swathii.hitTest(event.point, {fill:true}).item.fillColor.alpha);
			  //this.pallette.swathii.hitTest(event.point, {fill:true}).item.fillColor.alpha = .1;
			}
		},

		mouseDrag : function (event) {			
			// S/B
			if (this.hueSelect.hitTest(event.point, {fill:true})){
				this.sb.fillColor = this.pal.clone();
				this.pal.hue = (event.point.x - this.hueSelect.bounds.left);
				this.sb.fillColor.hue = (event.point.x - this.hueSelect.bounds.left);
				this.tiny.position.x = event.point.x
				this.palAlphaZero.hue = (event.point.x - this.hueSelect.bounds.left);
				this.palAlpha1.hue = (event.point.x - this.hueSelect.bounds.left);
			}
			if (this.as.hitTest(event.point, {fill:true})){
				this.pal.alpha = (event.point.y - this.as.bounds.top) / 340;
				this.sb.alpha = (event.point.y - this.sb.bounds.top) / 360;
			}
			if (this.sb.hitTest(event.point, {fill:true})){
				this.circ.position = event.point;
				var bright = (360 - Math.abs((event.point.x - this.sb.position.x)*2))/360;
				var sat = (360 - Math.abs((event.point.y - this.sb.position.y)*2))/360;;
				this.sb.fillColor.saturation = sat;
				this.sb.fillColor.brightness =  bright;
				this.pal.brightness = bright;
				this.pal.saturation = sat;
				this.palAlphaZero.saturation = sat;
				this.palAlphaZero.brightness = bright;
				this.palAlpha1.saturation = sat;
				this.palAlpha1.brightness = bright;
			}
			if(this.add.hitTest(event.point, {stroke:true})){
			  this.pallette.push(this.pal);
			  console.log(this.pallette)
			}
		}
	};

colorPicker.init();
 view.draw();
		/* 
 	mouseUp: function (event) {

		var segmentCount = line.segments.length;

		// When the mouse is released, simplify it:
		line.simplify(0);
		//line.smooth();

		// Select the line, so we can see its segments:
		line.fullySelected = false;

		var newSegmentCount = line.segments.length;
		var difference = segmentCount - newSegmentCount;
		var percentage = 100 - Math.round(newSegmentCount / segmentCount * 100);
		//textItem.content = difference + ' of the ' + segmentCount + ' segments were removed. Saving ' + percentage + '%\n meanwhile, here is your line data: '+line.segments;

	}
 		*/
};
	</script>
  <style>
  body, canvas, .canvas{
    background:#fff;
  }
  </style>

</head>
<body>
	<canvas id="canvas" resize style="background:white"></canvas>
</body>
</html>